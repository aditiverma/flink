machine:
  services:
    - docker
  environment:
    LD_LIBRARY_PATH: /usr/local/lib
    FLINK_VERSION: 1.3.2
    HADOOP_VERSION: 2.7.2
    SCALA_VERSION: 2.10

dependencies:
  cache_directories:
    - "~/.m2/"
  pre:
    - cd && git clone https://github.com/BranchMetrics/deploy.git
    - cp ~/deploy/maven/settings.xml $HOME/.m2/
    - cp ~/deploy/mesos/frameworks/flink/circle_build.sh $HOME/flink/
  override:
    - mvn -B clean compile -DskipTests -Drat.skip=true
  post:

test:
  override:
    - mvn -B clean package -DskipTests -Drat.skip=true
    - $HOME/flink/circle_build.sh

deployment:
  staging:
    branch: branch_1.3.0
    commands:
      - mvn -DscmCommentPrefix="[ci skip]" -B clean deploy -DskipTests=true -Drat.skip=true

  production:
    branch: branch_prod
    commands:
      - mvn -DscmCommentPrefix="[ci skip]" -B clean release:clean release:prepare release:perform
